import { c as createAstro, a as createComponent, r as renderTemplate, b as renderHead } from '../entry.mjs';
import Slugger from 'github-slugger';
import '@astrojs/netlify/netlify-functions.js';
import 'preact';
import 'preact-render-to-string';
import 'vue';
import 'vue/server-renderer';
import 'html-escaper';
import 'node-html-parser';
import 'axios';
/* empty css                           *//* empty css                           *//* empty css                           *//* empty css                           *//* empty css                          */import 'clone-deep';
import 'slugify';
import 'shiki';
/* empty css                           */import '@astrojs/rss';
/* empty css                           */import 'mime';
import 'cookie';
import 'kleur/colors';
import 'string-width';
import 'path-browserify';
import 'path-to-regexp';

const metadata = { "headings": [{ "depth": 2, "slug": "express-server", "text": "Express Server" }, { "depth": 3, "slug": "get-the-server-running", "text": "Get the Server Running" }, { "depth": 3, "slug": "multer", "text": "Multer" }, { "depth": 2, "slug": "html", "text": "HTML" }, { "depth": 3, "slug": "pure-html-no-javascript", "text": "Pure HTML (No Javascript)" }, { "depth": 3, "slug": "html-and-js-using-a-formdata-object", "text": "HTML and JS using a FormData object" }, { "depth": 4, "slug": "html-1", "text": "HTML" }, { "depth": 4, "slug": "javascript", "text": "Javascript" }, { "depth": 2, "slug": "conclusion", "text": "Conclusion" }], "source": "Here at Deepgram, we work with audio files all the time. We have SDKs that make it easy for developers to send audio files to our API. But it's also really useful to know how to post an audio file to a backend server in case you ever find yourself needing to do that. So I thought I would introduce a simple way for Node developers to take an audio file that is uploaded through the browser and send it to a backend Express.js server.\n\n## Express Server\n\nLet's start on the backend with our Express.js server. Express.js is a Node.js framework that provides us with so many useful methods and middleware, making working in Node that much easier.\n\nWe'll set up the server and implement a middleware package called Multer that helps us handle different file types that we receive to our post endpoint.\n\n### Get the Server Running\n\nWe can start our project by going into the terminal and making a new node project. Here's a reminder of how you would get that started:\n\n```bash\nmkdir project-name\ncd project-name\nnpm init\n```\n\nIf you want to set up a basic Express server, I go over step-by-step how to do that in [this post](https://dev.to/sandrarodgers/basic-express-server-using-replitcom-2ba9). We'll use that basic server code to get us started. In your project folder, create a file where you can place this code. The standard is to use `app.js` as your file where you put your server.\n\n```js\nconst express = require('express')\nconst cors = require('cors')\nconst app = express()\nconst port = 8080\n\napp.use(cors())\n\napp.get('/', (req, res) => {\n  res.json('Hello World')\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening at http://localhost:${port}`)\n})\n```\n\nYou see that we already have a GET endpoint where it says `app.get`. However, we don't want to just send out data from our server to the front end, we want to be able to *receive* an audio file to our server on the backend. So we will set up a POST endpoint to receive a data object sent from the client. Your most basic POST endpoint might look something like this:\n\n```js\napp.post('/test', (req, res, err) => {\n  console.log(req.body)\n  res.json('Successful post')\n})\n```\n\nA post endpoint expects a **request body** sent to it from the client-side. (When that data comes through to the server, you can see the data object in your terminal if you `console.log` the req.body like I did in the example). The format of that data sent in the request body (which is a set of key value pairs) will determine how you deal with the data you have been sent. **A post request using fetch on the client-side might send you a string, a Form Data object, a Blob (for binary data), or URL Search Parameters.**\n\nYou're probably more familiar with data being sent as a JSON encoded string, but since we want to send an audio file, we have to prepare for a different kind of data than JSON. On the front end (which we'll build in the next section), we intend to send the audio file by way of an HTML form, so **we can expect that the data we will be receiving at our server will come in as Form Data** (with a content-type of form/multipart). This [tutorial](https://javascript.info/fetch#post-requests) has all the info you need if you want to read more about fetch post requests and the different data types.\n\nNow, we could parse the raw data of the sound file ourselves (which would require a bunch of code and would probably make us feel very accomplished when we finally manage to get it working), or we could take advantage of the beauty of Node and use a tool that has already been made to help us with this immense task. There are [plenty of packages](https://npm.io/search/keyword:form-data) to choose from to help us handle Form Data, but since we are using Express, a great choice is [Multer](http://expressjs.com/en/resources/middleware/multer.html).\n\n### Multer\n\nMulter is a node.js middleware for handling multipart/form-data. If you're familiar with [body-parser](https://www.npmjs.com/package/body-parser), Multer is similar, except it is built only to deal with multipart bodies.\n\nTo use middleware in Express, we must bring in the package using `require`. We will also want to configure Multer for our needs, and we want to make sure that the audio file we are receiving actually gets written to the disk rather than just stored in memory. So we will include an options object like so `const upload = multer({opts})`, with 'opts' being the specific options for our configuration. **If you do not use the options object, multer will write the file to memory, so make sure you use the options object if you want your file stored on your disk.**\n\n```js\nconst multer = require('multer')\nconst upload = multer({ storage })\n```\n\nRight now, that storage property doesn't have anything behind it. It's an empty variable. But I'm going to show you how I configure that storage option.\n\n```js\nconst multer = require('multer')\n\nconst storage = multer.diskStorage({\n  filename: function (req, file, cb) {\n    console.log('filename')\n    cb(null, file.originalname)\n  },\n  destination: function (req, file, cb) {\n    console.log('storage')\n    cb(null, './uploads')\n  },\n})\n\nconst upload = multer({ storage })\n```\n\nAs you can see, I want to configure *how* we store the file. Using this `storage` option lets us use the Multer [disk storage engine](https://github.com/expressjs/multer#storage), which basically lets us program **how we want the file to be named** (using the disk storage `filename` method) and **where we wanted it to be stored** (using the disk storage `destination` method) . You can see in my code that I'm choosing to name the file exactly what it was named originally when it was sent to us from the client-side, and I am choosing to store it in a folder called `/uploads`.\n\nNow I will write out my post endpoint. It will include the Multer upload middleware. Since we are only uploading one file, I am using `upload.single()` but if you want to upload multiple files, Multer also has the `upload.array()` method. Multer adds a **request file** object which contains the file, and a **request body** object which contains the values of the text fields of the form.\n\n```js\napp.post('/upload_files', upload.single('file'), (req, res) => {\n  console.log(req.body)\n  console.log(req.file)\n  res.send({ message: 'Successfully uploaded files' })\n})\n```\n\nOne crucial thing to be sure of is that the parameter you include in the method (in this case, \"file\" in `upload.single(\"file\")` must correspond to the name field in your HTML form file input. According to the [Multer](https://github.com/expressjs/multer#usage) docs:\n\n> It is important that you use the `name` field value from the form in your upload function. This tells multer which field on the request it should look for the files in. If these fields aren't the same in the HTML form and on your server, your upload will fail.\n\nWe will make sure those values correspond when we build our HTML form in the next section.\n\n## HTML\n\nOver to the front-end now. In your project, you can make an `index.html` file, or you can test this out in something like CodePen. I'll link to both my examples in CodePen so you have access to the working front-end code.\n\n### Pure HTML (No Javascript)\n\nThe first example I want to show you is an HTML form that uses no Javascript.\n\n```html\n<form enctype=\"multipart/form-data\" action=\"http://localhost:8080/upload_files\" method=\"POST\">\n    <label for=\"file-upload\">Select file:</label>\n    <input id=\"file-upload\" type=\"file\" name=\"file\"/>\n <input type=\"submit\" value=\"POST to server\"></input>\n  </form>\n```\n\nThe form tag must include the `enctype` attribute to identify the media, or MIME type. For Multer, you must use `enctype=\"multipart/form-data\"`.\n\nWe also include the `action` attribute, which tells the form the url of the server and the endpoint. Since my server is running locally on port 8080 and my post endpoint path is `/upload_files`, I use the URL `http://localhost:8080/upload_files`. Lastly, we tell the form that the fetch method is `POST`.\n\nDon't forget to include a `name=\"\"` with the name field containing the parameter's name in the Multer upload method used in your Express server. See my working code at this [CodePen](https://codepen.io/sandrarodgers/pen/QWMQGXa?editors=1010).\n\n### HTML and JS using a FormData object\n\nA common need when sending a file is to include extra information with the file that you may want to use for some purpose on your backend, such as data you need to store along with the file. In that case, a way to do this is to use a Javascript FormData object. So in this example, I'll show you an HTML form that uses Javascript to include the FormData object. See my working code at this [CodePen](https://codepen.io/sandrarodgers/pen/XWazGem?editors=1011).\n\n#### HTML\n\n```html\n<form>\n  <label for=\"file\">Select files</label>\n  <input id=\"file\" type=\"file\" name=\"file\" />\n  <input type=\"submit\" value=\"POST to server\"></input>\n</form>\n```\n\nWe don't have to include the enctype attribute in the HTML form since that is already clear by it being a Form Data object we send in the Javascript. Also, the fetch post and URL/endpoint information are also included in the Javascript, so these are not needed in the HTML.\n\n#### Javascript\n\n```js\nconst form = document.querySelector('form')\nconst fileInput = document.getElementById('file')\nlet file\n\n//input file upload gets the file we want to post:\nhandleAudioFile = (e) => {\n  file = e.target.files\n  for (let i = 0; i <= file.length - 1; i++) {\n    file = file[i]\n  }\n}\nfileInput.addEventListener('change', handleAudioFile)\n\n//on clicking the submit button, we create the Form Data object, add the data value of the username to send as part of the request body and add the file to the object\nform.addEventListener('submit', (e) => {\n  e.preventDefault()\n  const formData = new FormData()\n  formData.append('username', 'Sandra Rodgers')\n  formData.append('files', file)\n\n  fetch('http://localhost:8080/upload_files', {\n    method: 'post',\n    body: formData,\n  })\n    .then((res) => console.log(res))\n    .catch((err) => ('Error occurred', err))\n})\n```\n\nThe Form Data allows us to send more info as key-value pairs that we can pull from the req.body when it gets to the server. Add the `append(\"key\", \"value\")` to the form data object for any information you want to add. There are [other methods](https://javascript.info/formdata) you can use to set up the Form Data object the way you want it.\n\nWhen you click the submit button, you can go to the `/uploads` folder you set up and see that your file has arrived!\n\n## Conclusion\n\nNow you are able to use Multer to send files to your Express.js server. Try sending some audio files or even image files. This is a good starting point for taking those files and moving them to another storage place, such as your Cloudinary account or a database.", "html": '<p>Here at Deepgram, we work with audio files all the time. We have SDKs that make it easy for developers to send audio files to our API. But it\u2019s also really useful to know how to post an audio file to a backend server in case you ever find yourself needing to do that. So I thought I would introduce a simple way for Node developers to take an audio file that is uploaded through the browser and send it to a backend Express.js server.</p>\n<h2 id="express-server">Express Server</h2>\n<p>Let\u2019s start on the backend with our Express.js server. Express.js is a Node.js framework that provides us with so many useful methods and middleware, making working in Node that much easier.</p>\n<p>We\u2019ll set up the server and implement a middleware package called Multer that helps us handle different file types that we receive to our post endpoint.</p>\n<h3 id="get-the-server-running">Get the Server Running</h3>\n<p>We can start our project by going into the terminal and making a new node project. Here\u2019s a reminder of how you would get that started:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">mkdir project-name</span></span>\n<span class="line"><span style="color: #79C0FF">cd</span><span style="color: #C9D1D9"> project-name</span></span>\n<span class="line"><span style="color: #C9D1D9">npm init</span></span></code></pre>\n<p>If you want to set up a basic Express server, I go over step-by-step how to do that in <a href="https://dev.to/sandrarodgers/basic-express-server-using-replitcom-2ba9">this post</a>. We\u2019ll use that basic server code to get us started. In your project folder, create a file where you can place this code. The standard is to use <code is:raw>app.js</code> as your file where you put your server.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">cors</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;cors&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">port</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8080</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">cors</span><span style="color: #C9D1D9">())</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Hello World&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(port, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">`Example app listening at http://localhost:${</span><span style="color: #C9D1D9">port</span><span style="color: #A5D6FF">}`</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>You see that we already have a GET endpoint where it says <code is:raw>app.get</code>. However, we don\u2019t want to just send out data from our server to the front end, we want to be able to <em>receive</em> an audio file to our server on the backend. So we will set up a POST endpoint to receive a data object sent from the client. Your most basic POST endpoint might look something like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/test&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Successful post&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>A post endpoint expects a <strong>request body</strong> sent to it from the client-side. (When that data comes through to the server, you can see the data object in your terminal if you <code is:raw>console.log</code> the req.body like I did in the example). The format of that data sent in the request body (which is a set of key value pairs) will determine how you deal with the data you have been sent. <strong>A post request using fetch on the client-side might send you a string, a Form Data object, a Blob (for binary data), or URL Search Parameters.</strong></p>\n<p>You\u2019re probably more familiar with data being sent as a JSON encoded string, but since we want to send an audio file, we have to prepare for a different kind of data than JSON. On the front end (which we\u2019ll build in the next section), we intend to send the audio file by way of an HTML form, so <strong>we can expect that the data we will be receiving at our server will come in as Form Data</strong> (with a content-type of form/multipart). This <a href="https://javascript.info/fetch#post-requests">tutorial</a> has all the info you need if you want to read more about fetch post requests and the different data types.</p>\n<p>Now, we could parse the raw data of the sound file ourselves (which would require a bunch of code and would probably make us feel very accomplished when we finally manage to get it working), or we could take advantage of the beauty of Node and use a tool that has already been made to help us with this immense task. There are <a href="https://npm.io/search/keyword:form-data">plenty of packages</a> to choose from to help us handle Form Data, but since we are using Express, a great choice is <a href="http://expressjs.com/en/resources/middleware/multer.html">Multer</a>.</p>\n<h3 id="multer">Multer</h3>\n<p>Multer is a node.js middleware for handling multipart/form-data. If you\u2019re familiar with <a href="https://www.npmjs.com/package/body-parser">body-parser</a>, Multer is similar, except it is built only to deal with multipart bodies.</p>\n<p>To use middleware in Express, we must bring in the package using <code is:raw>require</code>. We will also want to configure Multer for our needs, and we want to make sure that the audio file we are receiving actually gets written to the disk rather than just stored in memory. So we will include an options object like so <code is:raw>const upload = multer({opts})</code>, with \u2018opts\u2019 being the specific options for our configuration. <strong>If you do not use the options object, multer will write the file to memory, so make sure you use the options object if you want your file stored on your disk.</strong></p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>\n<p>Right now, that storage property doesn\u2019t have anything behind it. It\u2019s an empty variable. But I\u2019m going to show you how I configure that storage option.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">storage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> multer.</span><span style="color: #D2A8FF">diskStorage</span><span style="color: #C9D1D9">({</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">filename</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;filename&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, file.originalname)</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">destination</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;storage&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;./uploads&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>\n<p>As you can see, I want to configure <em>how</em> we store the file. Using this <code is:raw>storage</code> option lets us use the Multer <a href="https://github.com/expressjs/multer#storage">disk storage engine</a>, which basically lets us program <strong>how we want the file to be named</strong> (using the disk storage <code is:raw>filename</code> method) and <strong>where we wanted it to be stored</strong> (using the disk storage <code is:raw>destination</code> method) . You can see in my code that I\u2019m choosing to name the file exactly what it was named originally when it was sent to us from the client-side, and I am choosing to store it in a folder called <code is:raw>/uploads</code>.</p>\n<p>Now I will write out my post endpoint. It will include the Multer upload middleware. Since we are only uploading one file, I am using <code is:raw>upload.single()</code> but if you want to upload multiple files, Multer also has the <code is:raw>upload.array()</code> method. Multer adds a <strong>request file</strong> object which contains the file, and a <strong>request body</strong> object which contains the values of the text fields of the form.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/upload_files&#39;</span><span style="color: #C9D1D9">, upload.</span><span style="color: #D2A8FF">single</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">), (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.file)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">({ message: </span><span style="color: #A5D6FF">&#39;Successfully uploaded files&#39;</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>One crucial thing to be sure of is that the parameter you include in the method (in this case, \u201Cfile\u201D in <code is:raw>upload.single("file")</code> must correspond to the name field in your HTML form file input. According to the <a href="https://github.com/expressjs/multer#usage">Multer</a> docs:</p>\n<blockquote>\n<p>It is important that you use the <code is:raw>name</code> field value from the form in your upload function. This tells multer which field on the request it should look for the files in. If these fields aren\u2019t the same in the HTML form and on your server, your upload will fail.</p>\n</blockquote>\n<p>We will make sure those values correspond when we build our HTML form in the next section.</p>\n<h2 id="html">HTML</h2>\n<p>Over to the front-end now. In your project, you can make an <code is:raw>index.html</code> file, or you can test this out in something like CodePen. I\u2019ll link to both my examples in CodePen so you have access to the working front-end code.</p>\n<h3 id="pure-html-no-javascript">Pure HTML (No Javascript)</h3>\n<p>The first example I want to show you is an HTML form that uses no Javascript.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">enctype</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;multipart/form-data&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">action</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;http://localhost:8080/upload_files&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">method</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST&quot;</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9">&gt;Select file:&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">/&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9"> &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The form tag must include the <code is:raw>enctype</code> attribute to identify the media, or MIME type. For Multer, you must use <code is:raw>enctype="multipart/form-data"</code>.</p>\n<p>We also include the <code is:raw>action</code> attribute, which tells the form the url of the server and the endpoint. Since my server is running locally on port 8080 and my post endpoint path is <code is:raw>/upload_files</code>, I use the URL <code is:raw>http://localhost:8080/upload_files</code>. Lastly, we tell the form that the fetch method is <code is:raw>POST</code>.</p>\n<p>Don\u2019t forget to include a <code is:raw>name=""</code> with the name field containing the parameter\u2019s name in the Multer upload method used in your Express server. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/QWMQGXa?editors=1010">CodePen</a>.</p>\n<h3 id="html-and-js-using-a-formdata-object">HTML and JS using a FormData object</h3>\n<p>A common need when sending a file is to include extra information with the file that you may want to use for some purpose on your backend, such as data you need to store along with the file. In that case, a way to do this is to use a Javascript FormData object. So in this example, I\u2019ll show you an HTML form that uses Javascript to include the FormData object. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/XWazGem?editors=1011">CodePen</a>.</p>\n<h4 id="html-1">HTML</h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">&gt;Select files&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>We don\u2019t have to include the enctype attribute in the HTML form since that is already clear by it being a Form Data object we send in the Javascript. Also, the fetch post and URL/endpoint information are also included in the Javascript, so these are not needed in the HTML.</p>\n<h4 id="javascript">Javascript</h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">form</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;form&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">fileInput</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> file</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #8B949E">//input file upload gets the file we want to post:</span></span>\n<span class="line"><span style="color: #D2A8FF">handleAudioFile</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> e.target.files</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> file.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> file[i]</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span>\n<span class="line"><span style="color: #C9D1D9">fileInput.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;change&#39;</span><span style="color: #C9D1D9">, handleAudioFile)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #8B949E">//on clicking the submit button, we create the Form Data object, add the data value of the username to send as part of the request body and add the file to the object</span></span>\n<span class="line"><span style="color: #C9D1D9">form.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;submit&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  e.</span><span style="color: #D2A8FF">preventDefault</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">formData</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">FormData</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;username&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;Sandra Rodgers&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;files&#39;</span><span style="color: #C9D1D9">, file)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;http://localhost:8080/upload_files&#39;</span><span style="color: #C9D1D9">, {</span></span>\n<span class="line"><span style="color: #C9D1D9">    method: </span><span style="color: #A5D6FF">&#39;post&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    body: formData,</span></span>\n<span class="line"><span style="color: #C9D1D9">  })</span></span>\n<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(res))</span></span>\n<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">catch</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> (</span><span style="color: #A5D6FF">&#39;Error occurred&#39;</span><span style="color: #C9D1D9">, err))</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>The Form Data allows us to send more info as key-value pairs that we can pull from the req.body when it gets to the server. Add the <code is:raw>append("key", "value")</code> to the form data object for any information you want to add. There are <a href="https://javascript.info/formdata">other methods</a> you can use to set up the Form Data object the way you want it.</p>\n<p>When you click the submit button, you can go to the <code is:raw>/uploads</code> folder you set up and see that your file has arrived!</p>\n<h2 id="conclusion">Conclusion</h2>\n<p>Now you are able to use Multer to send files to your Express.js server. Try sending some audio files or even image files. This is a good starting point for taking those files and moving them to another storage place, such as your Cloudinary account or a database.</p>' };
const frontmatter = { "title": "Sending Audio Files to Your Express.js Server", "description": "Learn how to easily send files through an HTML form to an Express.js server using the middleware package Multer.", "date": "2021-11-18T00:00:00.000Z", "cover": "https://res.cloudinary.com/deepgram/image/upload/v1641852664/blog/2021/11/sending-audio-files-to-expressjs-server/Posting-Audio-File-to-Express-js-App%402x.jpg", "authors": ["sandra-rodgers"], "category": "tutorial", "tags": ["nodejs", "express"], "seo": { "title": "Sending Audio Files to your Express.js server", "description": "Learn how to easily send files through an HTML form to an Express.js server using the middleware package Multer." }, "og": { "image": "https://res.cloudinary.com/deepgram/image/upload/v1661453820/blog/sending-audio-files-to-expressjs-server/ograph.png" }, "shorturls": { "share": "https://dpgr.am/64d6c5c", "twitter": "https://dpgr.am/c511a95", "linkedin": "https://dpgr.am/5c6e6df", "reddit": "https://dpgr.am/b7f7b05", "facebook": "https://dpgr.am/d38a267" }, "astro": { "headings": [{ "depth": 2, "slug": "express-server", "text": "Express Server" }, { "depth": 3, "slug": "get-the-server-running", "text": "Get the Server Running" }, { "depth": 3, "slug": "multer", "text": "Multer" }, { "depth": 2, "slug": "html", "text": "HTML" }, { "depth": 3, "slug": "pure-html-no-javascript", "text": "Pure HTML (No Javascript)" }, { "depth": 3, "slug": "html-and-js-using-a-formdata-object", "text": "HTML and JS using a FormData object" }, { "depth": 4, "slug": "html-1", "text": "HTML" }, { "depth": 4, "slug": "javascript", "text": "Javascript" }, { "depth": 2, "slug": "conclusion", "text": "Conclusion" }], "source": "Here at Deepgram, we work with audio files all the time. We have SDKs that make it easy for developers to send audio files to our API. But it's also really useful to know how to post an audio file to a backend server in case you ever find yourself needing to do that. So I thought I would introduce a simple way for Node developers to take an audio file that is uploaded through the browser and send it to a backend Express.js server.\n\n## Express Server\n\nLet's start on the backend with our Express.js server. Express.js is a Node.js framework that provides us with so many useful methods and middleware, making working in Node that much easier.\n\nWe'll set up the server and implement a middleware package called Multer that helps us handle different file types that we receive to our post endpoint.\n\n### Get the Server Running\n\nWe can start our project by going into the terminal and making a new node project. Here's a reminder of how you would get that started:\n\n```bash\nmkdir project-name\ncd project-name\nnpm init\n```\n\nIf you want to set up a basic Express server, I go over step-by-step how to do that in [this post](https://dev.to/sandrarodgers/basic-express-server-using-replitcom-2ba9). We'll use that basic server code to get us started. In your project folder, create a file where you can place this code. The standard is to use `app.js` as your file where you put your server.\n\n```js\nconst express = require('express')\nconst cors = require('cors')\nconst app = express()\nconst port = 8080\n\napp.use(cors())\n\napp.get('/', (req, res) => {\n  res.json('Hello World')\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening at http://localhost:${port}`)\n})\n```\n\nYou see that we already have a GET endpoint where it says `app.get`. However, we don't want to just send out data from our server to the front end, we want to be able to *receive* an audio file to our server on the backend. So we will set up a POST endpoint to receive a data object sent from the client. Your most basic POST endpoint might look something like this:\n\n```js\napp.post('/test', (req, res, err) => {\n  console.log(req.body)\n  res.json('Successful post')\n})\n```\n\nA post endpoint expects a **request body** sent to it from the client-side. (When that data comes through to the server, you can see the data object in your terminal if you `console.log` the req.body like I did in the example). The format of that data sent in the request body (which is a set of key value pairs) will determine how you deal with the data you have been sent. **A post request using fetch on the client-side might send you a string, a Form Data object, a Blob (for binary data), or URL Search Parameters.**\n\nYou're probably more familiar with data being sent as a JSON encoded string, but since we want to send an audio file, we have to prepare for a different kind of data than JSON. On the front end (which we'll build in the next section), we intend to send the audio file by way of an HTML form, so **we can expect that the data we will be receiving at our server will come in as Form Data** (with a content-type of form/multipart). This [tutorial](https://javascript.info/fetch#post-requests) has all the info you need if you want to read more about fetch post requests and the different data types.\n\nNow, we could parse the raw data of the sound file ourselves (which would require a bunch of code and would probably make us feel very accomplished when we finally manage to get it working), or we could take advantage of the beauty of Node and use a tool that has already been made to help us with this immense task. There are [plenty of packages](https://npm.io/search/keyword:form-data) to choose from to help us handle Form Data, but since we are using Express, a great choice is [Multer](http://expressjs.com/en/resources/middleware/multer.html).\n\n### Multer\n\nMulter is a node.js middleware for handling multipart/form-data. If you're familiar with [body-parser](https://www.npmjs.com/package/body-parser), Multer is similar, except it is built only to deal with multipart bodies.\n\nTo use middleware in Express, we must bring in the package using `require`. We will also want to configure Multer for our needs, and we want to make sure that the audio file we are receiving actually gets written to the disk rather than just stored in memory. So we will include an options object like so `const upload = multer({opts})`, with 'opts' being the specific options for our configuration. **If you do not use the options object, multer will write the file to memory, so make sure you use the options object if you want your file stored on your disk.**\n\n```js\nconst multer = require('multer')\nconst upload = multer({ storage })\n```\n\nRight now, that storage property doesn't have anything behind it. It's an empty variable. But I'm going to show you how I configure that storage option.\n\n```js\nconst multer = require('multer')\n\nconst storage = multer.diskStorage({\n  filename: function (req, file, cb) {\n    console.log('filename')\n    cb(null, file.originalname)\n  },\n  destination: function (req, file, cb) {\n    console.log('storage')\n    cb(null, './uploads')\n  },\n})\n\nconst upload = multer({ storage })\n```\n\nAs you can see, I want to configure *how* we store the file. Using this `storage` option lets us use the Multer [disk storage engine](https://github.com/expressjs/multer#storage), which basically lets us program **how we want the file to be named** (using the disk storage `filename` method) and **where we wanted it to be stored** (using the disk storage `destination` method) . You can see in my code that I'm choosing to name the file exactly what it was named originally when it was sent to us from the client-side, and I am choosing to store it in a folder called `/uploads`.\n\nNow I will write out my post endpoint. It will include the Multer upload middleware. Since we are only uploading one file, I am using `upload.single()` but if you want to upload multiple files, Multer also has the `upload.array()` method. Multer adds a **request file** object which contains the file, and a **request body** object which contains the values of the text fields of the form.\n\n```js\napp.post('/upload_files', upload.single('file'), (req, res) => {\n  console.log(req.body)\n  console.log(req.file)\n  res.send({ message: 'Successfully uploaded files' })\n})\n```\n\nOne crucial thing to be sure of is that the parameter you include in the method (in this case, \"file\" in `upload.single(\"file\")` must correspond to the name field in your HTML form file input. According to the [Multer](https://github.com/expressjs/multer#usage) docs:\n\n> It is important that you use the `name` field value from the form in your upload function. This tells multer which field on the request it should look for the files in. If these fields aren't the same in the HTML form and on your server, your upload will fail.\n\nWe will make sure those values correspond when we build our HTML form in the next section.\n\n## HTML\n\nOver to the front-end now. In your project, you can make an `index.html` file, or you can test this out in something like CodePen. I'll link to both my examples in CodePen so you have access to the working front-end code.\n\n### Pure HTML (No Javascript)\n\nThe first example I want to show you is an HTML form that uses no Javascript.\n\n```html\n<form enctype=\"multipart/form-data\" action=\"http://localhost:8080/upload_files\" method=\"POST\">\n    <label for=\"file-upload\">Select file:</label>\n    <input id=\"file-upload\" type=\"file\" name=\"file\"/>\n <input type=\"submit\" value=\"POST to server\"></input>\n  </form>\n```\n\nThe form tag must include the `enctype` attribute to identify the media, or MIME type. For Multer, you must use `enctype=\"multipart/form-data\"`.\n\nWe also include the `action` attribute, which tells the form the url of the server and the endpoint. Since my server is running locally on port 8080 and my post endpoint path is `/upload_files`, I use the URL `http://localhost:8080/upload_files`. Lastly, we tell the form that the fetch method is `POST`.\n\nDon't forget to include a `name=\"\"` with the name field containing the parameter's name in the Multer upload method used in your Express server. See my working code at this [CodePen](https://codepen.io/sandrarodgers/pen/QWMQGXa?editors=1010).\n\n### HTML and JS using a FormData object\n\nA common need when sending a file is to include extra information with the file that you may want to use for some purpose on your backend, such as data you need to store along with the file. In that case, a way to do this is to use a Javascript FormData object. So in this example, I'll show you an HTML form that uses Javascript to include the FormData object. See my working code at this [CodePen](https://codepen.io/sandrarodgers/pen/XWazGem?editors=1011).\n\n#### HTML\n\n```html\n<form>\n  <label for=\"file\">Select files</label>\n  <input id=\"file\" type=\"file\" name=\"file\" />\n  <input type=\"submit\" value=\"POST to server\"></input>\n</form>\n```\n\nWe don't have to include the enctype attribute in the HTML form since that is already clear by it being a Form Data object we send in the Javascript. Also, the fetch post and URL/endpoint information are also included in the Javascript, so these are not needed in the HTML.\n\n#### Javascript\n\n```js\nconst form = document.querySelector('form')\nconst fileInput = document.getElementById('file')\nlet file\n\n//input file upload gets the file we want to post:\nhandleAudioFile = (e) => {\n  file = e.target.files\n  for (let i = 0; i <= file.length - 1; i++) {\n    file = file[i]\n  }\n}\nfileInput.addEventListener('change', handleAudioFile)\n\n//on clicking the submit button, we create the Form Data object, add the data value of the username to send as part of the request body and add the file to the object\nform.addEventListener('submit', (e) => {\n  e.preventDefault()\n  const formData = new FormData()\n  formData.append('username', 'Sandra Rodgers')\n  formData.append('files', file)\n\n  fetch('http://localhost:8080/upload_files', {\n    method: 'post',\n    body: formData,\n  })\n    .then((res) => console.log(res))\n    .catch((err) => ('Error occurred', err))\n})\n```\n\nThe Form Data allows us to send more info as key-value pairs that we can pull from the req.body when it gets to the server. Add the `append(\"key\", \"value\")` to the form data object for any information you want to add. There are [other methods](https://javascript.info/formdata) you can use to set up the Form Data object the way you want it.\n\nWhen you click the submit button, you can go to the `/uploads` folder you set up and see that your file has arrived!\n\n## Conclusion\n\nNow you are able to use Multer to send files to your Express.js server. Try sending some audio files or even image files. This is a good starting point for taking those files and moving them to another storage place, such as your Cloudinary account or a database.", "html": '<p>Here at Deepgram, we work with audio files all the time. We have SDKs that make it easy for developers to send audio files to our API. But it\u2019s also really useful to know how to post an audio file to a backend server in case you ever find yourself needing to do that. So I thought I would introduce a simple way for Node developers to take an audio file that is uploaded through the browser and send it to a backend Express.js server.</p>\n<h2 id="express-server">Express Server</h2>\n<p>Let\u2019s start on the backend with our Express.js server. Express.js is a Node.js framework that provides us with so many useful methods and middleware, making working in Node that much easier.</p>\n<p>We\u2019ll set up the server and implement a middleware package called Multer that helps us handle different file types that we receive to our post endpoint.</p>\n<h3 id="get-the-server-running">Get the Server Running</h3>\n<p>We can start our project by going into the terminal and making a new node project. Here\u2019s a reminder of how you would get that started:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">mkdir project-name</span></span>\n<span class="line"><span style="color: #79C0FF">cd</span><span style="color: #C9D1D9"> project-name</span></span>\n<span class="line"><span style="color: #C9D1D9">npm init</span></span></code></pre>\n<p>If you want to set up a basic Express server, I go over step-by-step how to do that in <a href="https://dev.to/sandrarodgers/basic-express-server-using-replitcom-2ba9">this post</a>. We\u2019ll use that basic server code to get us started. In your project folder, create a file where you can place this code. The standard is to use <code is:raw>app.js</code> as your file where you put your server.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">cors</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;cors&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">port</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8080</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">cors</span><span style="color: #C9D1D9">())</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Hello World&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(port, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">`Example app listening at http://localhost:${</span><span style="color: #C9D1D9">port</span><span style="color: #A5D6FF">}`</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>You see that we already have a GET endpoint where it says <code is:raw>app.get</code>. However, we don\u2019t want to just send out data from our server to the front end, we want to be able to <em>receive</em> an audio file to our server on the backend. So we will set up a POST endpoint to receive a data object sent from the client. Your most basic POST endpoint might look something like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/test&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Successful post&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>A post endpoint expects a <strong>request body</strong> sent to it from the client-side. (When that data comes through to the server, you can see the data object in your terminal if you <code is:raw>console.log</code> the req.body like I did in the example). The format of that data sent in the request body (which is a set of key value pairs) will determine how you deal with the data you have been sent. <strong>A post request using fetch on the client-side might send you a string, a Form Data object, a Blob (for binary data), or URL Search Parameters.</strong></p>\n<p>You\u2019re probably more familiar with data being sent as a JSON encoded string, but since we want to send an audio file, we have to prepare for a different kind of data than JSON. On the front end (which we\u2019ll build in the next section), we intend to send the audio file by way of an HTML form, so <strong>we can expect that the data we will be receiving at our server will come in as Form Data</strong> (with a content-type of form/multipart). This <a href="https://javascript.info/fetch#post-requests">tutorial</a> has all the info you need if you want to read more about fetch post requests and the different data types.</p>\n<p>Now, we could parse the raw data of the sound file ourselves (which would require a bunch of code and would probably make us feel very accomplished when we finally manage to get it working), or we could take advantage of the beauty of Node and use a tool that has already been made to help us with this immense task. There are <a href="https://npm.io/search/keyword:form-data">plenty of packages</a> to choose from to help us handle Form Data, but since we are using Express, a great choice is <a href="http://expressjs.com/en/resources/middleware/multer.html">Multer</a>.</p>\n<h3 id="multer">Multer</h3>\n<p>Multer is a node.js middleware for handling multipart/form-data. If you\u2019re familiar with <a href="https://www.npmjs.com/package/body-parser">body-parser</a>, Multer is similar, except it is built only to deal with multipart bodies.</p>\n<p>To use middleware in Express, we must bring in the package using <code is:raw>require</code>. We will also want to configure Multer for our needs, and we want to make sure that the audio file we are receiving actually gets written to the disk rather than just stored in memory. So we will include an options object like so <code is:raw>const upload = multer({opts})</code>, with \u2018opts\u2019 being the specific options for our configuration. <strong>If you do not use the options object, multer will write the file to memory, so make sure you use the options object if you want your file stored on your disk.</strong></p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>\n<p>Right now, that storage property doesn\u2019t have anything behind it. It\u2019s an empty variable. But I\u2019m going to show you how I configure that storage option.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">storage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> multer.</span><span style="color: #D2A8FF">diskStorage</span><span style="color: #C9D1D9">({</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">filename</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;filename&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, file.originalname)</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">destination</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;storage&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;./uploads&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>\n<p>As you can see, I want to configure <em>how</em> we store the file. Using this <code is:raw>storage</code> option lets us use the Multer <a href="https://github.com/expressjs/multer#storage">disk storage engine</a>, which basically lets us program <strong>how we want the file to be named</strong> (using the disk storage <code is:raw>filename</code> method) and <strong>where we wanted it to be stored</strong> (using the disk storage <code is:raw>destination</code> method) . You can see in my code that I\u2019m choosing to name the file exactly what it was named originally when it was sent to us from the client-side, and I am choosing to store it in a folder called <code is:raw>/uploads</code>.</p>\n<p>Now I will write out my post endpoint. It will include the Multer upload middleware. Since we are only uploading one file, I am using <code is:raw>upload.single()</code> but if you want to upload multiple files, Multer also has the <code is:raw>upload.array()</code> method. Multer adds a <strong>request file</strong> object which contains the file, and a <strong>request body</strong> object which contains the values of the text fields of the form.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/upload_files&#39;</span><span style="color: #C9D1D9">, upload.</span><span style="color: #D2A8FF">single</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">), (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.file)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">({ message: </span><span style="color: #A5D6FF">&#39;Successfully uploaded files&#39;</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>One crucial thing to be sure of is that the parameter you include in the method (in this case, \u201Cfile\u201D in <code is:raw>upload.single("file")</code> must correspond to the name field in your HTML form file input. According to the <a href="https://github.com/expressjs/multer#usage">Multer</a> docs:</p>\n<blockquote>\n<p>It is important that you use the <code is:raw>name</code> field value from the form in your upload function. This tells multer which field on the request it should look for the files in. If these fields aren\u2019t the same in the HTML form and on your server, your upload will fail.</p>\n</blockquote>\n<p>We will make sure those values correspond when we build our HTML form in the next section.</p>\n<h2 id="html">HTML</h2>\n<p>Over to the front-end now. In your project, you can make an <code is:raw>index.html</code> file, or you can test this out in something like CodePen. I\u2019ll link to both my examples in CodePen so you have access to the working front-end code.</p>\n<h3 id="pure-html-no-javascript">Pure HTML (No Javascript)</h3>\n<p>The first example I want to show you is an HTML form that uses no Javascript.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">enctype</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;multipart/form-data&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">action</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;http://localhost:8080/upload_files&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">method</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST&quot;</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9">&gt;Select file:&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">/&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9"> &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The form tag must include the <code is:raw>enctype</code> attribute to identify the media, or MIME type. For Multer, you must use <code is:raw>enctype="multipart/form-data"</code>.</p>\n<p>We also include the <code is:raw>action</code> attribute, which tells the form the url of the server and the endpoint. Since my server is running locally on port 8080 and my post endpoint path is <code is:raw>/upload_files</code>, I use the URL <code is:raw>http://localhost:8080/upload_files</code>. Lastly, we tell the form that the fetch method is <code is:raw>POST</code>.</p>\n<p>Don\u2019t forget to include a <code is:raw>name=""</code> with the name field containing the parameter\u2019s name in the Multer upload method used in your Express server. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/QWMQGXa?editors=1010">CodePen</a>.</p>\n<h3 id="html-and-js-using-a-formdata-object">HTML and JS using a FormData object</h3>\n<p>A common need when sending a file is to include extra information with the file that you may want to use for some purpose on your backend, such as data you need to store along with the file. In that case, a way to do this is to use a Javascript FormData object. So in this example, I\u2019ll show you an HTML form that uses Javascript to include the FormData object. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/XWazGem?editors=1011">CodePen</a>.</p>\n<h4 id="html-1">HTML</h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">&gt;Select files&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>We don\u2019t have to include the enctype attribute in the HTML form since that is already clear by it being a Form Data object we send in the Javascript. Also, the fetch post and URL/endpoint information are also included in the Javascript, so these are not needed in the HTML.</p>\n<h4 id="javascript">Javascript</h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">form</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;form&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">fileInput</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> file</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #8B949E">//input file upload gets the file we want to post:</span></span>\n<span class="line"><span style="color: #D2A8FF">handleAudioFile</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> e.target.files</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> file.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> file[i]</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span>\n<span class="line"><span style="color: #C9D1D9">fileInput.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;change&#39;</span><span style="color: #C9D1D9">, handleAudioFile)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #8B949E">//on clicking the submit button, we create the Form Data object, add the data value of the username to send as part of the request body and add the file to the object</span></span>\n<span class="line"><span style="color: #C9D1D9">form.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;submit&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  e.</span><span style="color: #D2A8FF">preventDefault</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">formData</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">FormData</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;username&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;Sandra Rodgers&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;files&#39;</span><span style="color: #C9D1D9">, file)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;http://localhost:8080/upload_files&#39;</span><span style="color: #C9D1D9">, {</span></span>\n<span class="line"><span style="color: #C9D1D9">    method: </span><span style="color: #A5D6FF">&#39;post&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    body: formData,</span></span>\n<span class="line"><span style="color: #C9D1D9">  })</span></span>\n<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(res))</span></span>\n<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">catch</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> (</span><span style="color: #A5D6FF">&#39;Error occurred&#39;</span><span style="color: #C9D1D9">, err))</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>The Form Data allows us to send more info as key-value pairs that we can pull from the req.body when it gets to the server. Add the <code is:raw>append("key", "value")</code> to the form data object for any information you want to add. There are <a href="https://javascript.info/formdata">other methods</a> you can use to set up the Form Data object the way you want it.</p>\n<p>When you click the submit button, you can go to the <code is:raw>/uploads</code> folder you set up and see that your file has arrived!</p>\n<h2 id="conclusion">Conclusion</h2>\n<p>Now you are able to use Multer to send files to your Express.js server. Try sending some audio files or even image files. This is a good starting point for taking those files and moving them to another storage place, such as your Cloudinary account or a database.</p>' }, "file": "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/sending-audio-files-to-expressjs-server/index.md" };
function rawContent() {
  return "Here at Deepgram, we work with audio files all the time. We have SDKs that make it easy for developers to send audio files to our API. But it's also really useful to know how to post an audio file to a backend server in case you ever find yourself needing to do that. So I thought I would introduce a simple way for Node developers to take an audio file that is uploaded through the browser and send it to a backend Express.js server.\n\n## Express Server\n\nLet's start on the backend with our Express.js server. Express.js is a Node.js framework that provides us with so many useful methods and middleware, making working in Node that much easier.\n\nWe'll set up the server and implement a middleware package called Multer that helps us handle different file types that we receive to our post endpoint.\n\n### Get the Server Running\n\nWe can start our project by going into the terminal and making a new node project. Here's a reminder of how you would get that started:\n\n```bash\nmkdir project-name\ncd project-name\nnpm init\n```\n\nIf you want to set up a basic Express server, I go over step-by-step how to do that in [this post](https://dev.to/sandrarodgers/basic-express-server-using-replitcom-2ba9). We'll use that basic server code to get us started. In your project folder, create a file where you can place this code. The standard is to use `app.js` as your file where you put your server.\n\n```js\nconst express = require('express')\nconst cors = require('cors')\nconst app = express()\nconst port = 8080\n\napp.use(cors())\n\napp.get('/', (req, res) => {\n  res.json('Hello World')\n})\n\napp.listen(port, () => {\n  console.log(`Example app listening at http://localhost:${port}`)\n})\n```\n\nYou see that we already have a GET endpoint where it says `app.get`. However, we don't want to just send out data from our server to the front end, we want to be able to *receive* an audio file to our server on the backend. So we will set up a POST endpoint to receive a data object sent from the client. Your most basic POST endpoint might look something like this:\n\n```js\napp.post('/test', (req, res, err) => {\n  console.log(req.body)\n  res.json('Successful post')\n})\n```\n\nA post endpoint expects a **request body** sent to it from the client-side. (When that data comes through to the server, you can see the data object in your terminal if you `console.log` the req.body like I did in the example). The format of that data sent in the request body (which is a set of key value pairs) will determine how you deal with the data you have been sent. **A post request using fetch on the client-side might send you a string, a Form Data object, a Blob (for binary data), or URL Search Parameters.**\n\nYou're probably more familiar with data being sent as a JSON encoded string, but since we want to send an audio file, we have to prepare for a different kind of data than JSON. On the front end (which we'll build in the next section), we intend to send the audio file by way of an HTML form, so **we can expect that the data we will be receiving at our server will come in as Form Data** (with a content-type of form/multipart). This [tutorial](https://javascript.info/fetch#post-requests) has all the info you need if you want to read more about fetch post requests and the different data types.\n\nNow, we could parse the raw data of the sound file ourselves (which would require a bunch of code and would probably make us feel very accomplished when we finally manage to get it working), or we could take advantage of the beauty of Node and use a tool that has already been made to help us with this immense task. There are [plenty of packages](https://npm.io/search/keyword:form-data) to choose from to help us handle Form Data, but since we are using Express, a great choice is [Multer](http://expressjs.com/en/resources/middleware/multer.html).\n\n### Multer\n\nMulter is a node.js middleware for handling multipart/form-data. If you're familiar with [body-parser](https://www.npmjs.com/package/body-parser), Multer is similar, except it is built only to deal with multipart bodies.\n\nTo use middleware in Express, we must bring in the package using `require`. We will also want to configure Multer for our needs, and we want to make sure that the audio file we are receiving actually gets written to the disk rather than just stored in memory. So we will include an options object like so `const upload = multer({opts})`, with 'opts' being the specific options for our configuration. **If you do not use the options object, multer will write the file to memory, so make sure you use the options object if you want your file stored on your disk.**\n\n```js\nconst multer = require('multer')\nconst upload = multer({ storage })\n```\n\nRight now, that storage property doesn't have anything behind it. It's an empty variable. But I'm going to show you how I configure that storage option.\n\n```js\nconst multer = require('multer')\n\nconst storage = multer.diskStorage({\n  filename: function (req, file, cb) {\n    console.log('filename')\n    cb(null, file.originalname)\n  },\n  destination: function (req, file, cb) {\n    console.log('storage')\n    cb(null, './uploads')\n  },\n})\n\nconst upload = multer({ storage })\n```\n\nAs you can see, I want to configure *how* we store the file. Using this `storage` option lets us use the Multer [disk storage engine](https://github.com/expressjs/multer#storage), which basically lets us program **how we want the file to be named** (using the disk storage `filename` method) and **where we wanted it to be stored** (using the disk storage `destination` method) . You can see in my code that I'm choosing to name the file exactly what it was named originally when it was sent to us from the client-side, and I am choosing to store it in a folder called `/uploads`.\n\nNow I will write out my post endpoint. It will include the Multer upload middleware. Since we are only uploading one file, I am using `upload.single()` but if you want to upload multiple files, Multer also has the `upload.array()` method. Multer adds a **request file** object which contains the file, and a **request body** object which contains the values of the text fields of the form.\n\n```js\napp.post('/upload_files', upload.single('file'), (req, res) => {\n  console.log(req.body)\n  console.log(req.file)\n  res.send({ message: 'Successfully uploaded files' })\n})\n```\n\nOne crucial thing to be sure of is that the parameter you include in the method (in this case, \"file\" in `upload.single(\"file\")` must correspond to the name field in your HTML form file input. According to the [Multer](https://github.com/expressjs/multer#usage) docs:\n\n> It is important that you use the `name` field value from the form in your upload function. This tells multer which field on the request it should look for the files in. If these fields aren't the same in the HTML form and on your server, your upload will fail.\n\nWe will make sure those values correspond when we build our HTML form in the next section.\n\n## HTML\n\nOver to the front-end now. In your project, you can make an `index.html` file, or you can test this out in something like CodePen. I'll link to both my examples in CodePen so you have access to the working front-end code.\n\n### Pure HTML (No Javascript)\n\nThe first example I want to show you is an HTML form that uses no Javascript.\n\n```html\n<form enctype=\"multipart/form-data\" action=\"http://localhost:8080/upload_files\" method=\"POST\">\n    <label for=\"file-upload\">Select file:</label>\n    <input id=\"file-upload\" type=\"file\" name=\"file\"/>\n <input type=\"submit\" value=\"POST to server\"></input>\n  </form>\n```\n\nThe form tag must include the `enctype` attribute to identify the media, or MIME type. For Multer, you must use `enctype=\"multipart/form-data\"`.\n\nWe also include the `action` attribute, which tells the form the url of the server and the endpoint. Since my server is running locally on port 8080 and my post endpoint path is `/upload_files`, I use the URL `http://localhost:8080/upload_files`. Lastly, we tell the form that the fetch method is `POST`.\n\nDon't forget to include a `name=\"\"` with the name field containing the parameter's name in the Multer upload method used in your Express server. See my working code at this [CodePen](https://codepen.io/sandrarodgers/pen/QWMQGXa?editors=1010).\n\n### HTML and JS using a FormData object\n\nA common need when sending a file is to include extra information with the file that you may want to use for some purpose on your backend, such as data you need to store along with the file. In that case, a way to do this is to use a Javascript FormData object. So in this example, I'll show you an HTML form that uses Javascript to include the FormData object. See my working code at this [CodePen](https://codepen.io/sandrarodgers/pen/XWazGem?editors=1011).\n\n#### HTML\n\n```html\n<form>\n  <label for=\"file\">Select files</label>\n  <input id=\"file\" type=\"file\" name=\"file\" />\n  <input type=\"submit\" value=\"POST to server\"></input>\n</form>\n```\n\nWe don't have to include the enctype attribute in the HTML form since that is already clear by it being a Form Data object we send in the Javascript. Also, the fetch post and URL/endpoint information are also included in the Javascript, so these are not needed in the HTML.\n\n#### Javascript\n\n```js\nconst form = document.querySelector('form')\nconst fileInput = document.getElementById('file')\nlet file\n\n//input file upload gets the file we want to post:\nhandleAudioFile = (e) => {\n  file = e.target.files\n  for (let i = 0; i <= file.length - 1; i++) {\n    file = file[i]\n  }\n}\nfileInput.addEventListener('change', handleAudioFile)\n\n//on clicking the submit button, we create the Form Data object, add the data value of the username to send as part of the request body and add the file to the object\nform.addEventListener('submit', (e) => {\n  e.preventDefault()\n  const formData = new FormData()\n  formData.append('username', 'Sandra Rodgers')\n  formData.append('files', file)\n\n  fetch('http://localhost:8080/upload_files', {\n    method: 'post',\n    body: formData,\n  })\n    .then((res) => console.log(res))\n    .catch((err) => ('Error occurred', err))\n})\n```\n\nThe Form Data allows us to send more info as key-value pairs that we can pull from the req.body when it gets to the server. Add the `append(\"key\", \"value\")` to the form data object for any information you want to add. There are [other methods](https://javascript.info/formdata) you can use to set up the Form Data object the way you want it.\n\nWhen you click the submit button, you can go to the `/uploads` folder you set up and see that your file has arrived!\n\n## Conclusion\n\nNow you are able to use Multer to send files to your Express.js server. Try sending some audio files or even image files. This is a good starting point for taking those files and moving them to another storage place, such as your Cloudinary account or a database.";
}
function compiledContent() {
  return '<p>Here at Deepgram, we work with audio files all the time. We have SDKs that make it easy for developers to send audio files to our API. But it\u2019s also really useful to know how to post an audio file to a backend server in case you ever find yourself needing to do that. So I thought I would introduce a simple way for Node developers to take an audio file that is uploaded through the browser and send it to a backend Express.js server.</p>\n<h2 id="express-server">Express Server</h2>\n<p>Let\u2019s start on the backend with our Express.js server. Express.js is a Node.js framework that provides us with so many useful methods and middleware, making working in Node that much easier.</p>\n<p>We\u2019ll set up the server and implement a middleware package called Multer that helps us handle different file types that we receive to our post endpoint.</p>\n<h3 id="get-the-server-running">Get the Server Running</h3>\n<p>We can start our project by going into the terminal and making a new node project. Here\u2019s a reminder of how you would get that started:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">mkdir project-name</span></span>\n<span class="line"><span style="color: #79C0FF">cd</span><span style="color: #C9D1D9"> project-name</span></span>\n<span class="line"><span style="color: #C9D1D9">npm init</span></span></code></pre>\n<p>If you want to set up a basic Express server, I go over step-by-step how to do that in <a href="https://dev.to/sandrarodgers/basic-express-server-using-replitcom-2ba9">this post</a>. We\u2019ll use that basic server code to get us started. In your project folder, create a file where you can place this code. The standard is to use <code is:raw>app.js</code> as your file where you put your server.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">cors</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;cors&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">port</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8080</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">cors</span><span style="color: #C9D1D9">())</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Hello World&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(port, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">`Example app listening at http://localhost:${</span><span style="color: #C9D1D9">port</span><span style="color: #A5D6FF">}`</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>You see that we already have a GET endpoint where it says <code is:raw>app.get</code>. However, we don\u2019t want to just send out data from our server to the front end, we want to be able to <em>receive</em> an audio file to our server on the backend. So we will set up a POST endpoint to receive a data object sent from the client. Your most basic POST endpoint might look something like this:</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/test&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Successful post&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>A post endpoint expects a <strong>request body</strong> sent to it from the client-side. (When that data comes through to the server, you can see the data object in your terminal if you <code is:raw>console.log</code> the req.body like I did in the example). The format of that data sent in the request body (which is a set of key value pairs) will determine how you deal with the data you have been sent. <strong>A post request using fetch on the client-side might send you a string, a Form Data object, a Blob (for binary data), or URL Search Parameters.</strong></p>\n<p>You\u2019re probably more familiar with data being sent as a JSON encoded string, but since we want to send an audio file, we have to prepare for a different kind of data than JSON. On the front end (which we\u2019ll build in the next section), we intend to send the audio file by way of an HTML form, so <strong>we can expect that the data we will be receiving at our server will come in as Form Data</strong> (with a content-type of form/multipart). This <a href="https://javascript.info/fetch#post-requests">tutorial</a> has all the info you need if you want to read more about fetch post requests and the different data types.</p>\n<p>Now, we could parse the raw data of the sound file ourselves (which would require a bunch of code and would probably make us feel very accomplished when we finally manage to get it working), or we could take advantage of the beauty of Node and use a tool that has already been made to help us with this immense task. There are <a href="https://npm.io/search/keyword:form-data">plenty of packages</a> to choose from to help us handle Form Data, but since we are using Express, a great choice is <a href="http://expressjs.com/en/resources/middleware/multer.html">Multer</a>.</p>\n<h3 id="multer">Multer</h3>\n<p>Multer is a node.js middleware for handling multipart/form-data. If you\u2019re familiar with <a href="https://www.npmjs.com/package/body-parser">body-parser</a>, Multer is similar, except it is built only to deal with multipart bodies.</p>\n<p>To use middleware in Express, we must bring in the package using <code is:raw>require</code>. We will also want to configure Multer for our needs, and we want to make sure that the audio file we are receiving actually gets written to the disk rather than just stored in memory. So we will include an options object like so <code is:raw>const upload = multer({opts})</code>, with \u2018opts\u2019 being the specific options for our configuration. <strong>If you do not use the options object, multer will write the file to memory, so make sure you use the options object if you want your file stored on your disk.</strong></p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>\n<p>Right now, that storage property doesn\u2019t have anything behind it. It\u2019s an empty variable. But I\u2019m going to show you how I configure that storage option.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">storage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> multer.</span><span style="color: #D2A8FF">diskStorage</span><span style="color: #C9D1D9">({</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">filename</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;filename&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, file.originalname)</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">destination</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;storage&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;./uploads&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  },</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>\n<p>As you can see, I want to configure <em>how</em> we store the file. Using this <code is:raw>storage</code> option lets us use the Multer <a href="https://github.com/expressjs/multer#storage">disk storage engine</a>, which basically lets us program <strong>how we want the file to be named</strong> (using the disk storage <code is:raw>filename</code> method) and <strong>where we wanted it to be stored</strong> (using the disk storage <code is:raw>destination</code> method) . You can see in my code that I\u2019m choosing to name the file exactly what it was named originally when it was sent to us from the client-side, and I am choosing to store it in a folder called <code is:raw>/uploads</code>.</p>\n<p>Now I will write out my post endpoint. It will include the Multer upload middleware. Since we are only uploading one file, I am using <code is:raw>upload.single()</code> but if you want to upload multiple files, Multer also has the <code is:raw>upload.array()</code> method. Multer adds a <strong>request file</strong> object which contains the file, and a <strong>request body</strong> object which contains the values of the text fields of the form.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/upload_files&#39;</span><span style="color: #C9D1D9">, upload.</span><span style="color: #D2A8FF">single</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">), (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>\n<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.file)</span></span>\n<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">({ message: </span><span style="color: #A5D6FF">&#39;Successfully uploaded files&#39;</span><span style="color: #C9D1D9"> })</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>One crucial thing to be sure of is that the parameter you include in the method (in this case, \u201Cfile\u201D in <code is:raw>upload.single("file")</code> must correspond to the name field in your HTML form file input. According to the <a href="https://github.com/expressjs/multer#usage">Multer</a> docs:</p>\n<blockquote>\n<p>It is important that you use the <code is:raw>name</code> field value from the form in your upload function. This tells multer which field on the request it should look for the files in. If these fields aren\u2019t the same in the HTML form and on your server, your upload will fail.</p>\n</blockquote>\n<p>We will make sure those values correspond when we build our HTML form in the next section.</p>\n<h2 id="html">HTML</h2>\n<p>Over to the front-end now. In your project, you can make an <code is:raw>index.html</code> file, or you can test this out in something like CodePen. I\u2019ll link to both my examples in CodePen so you have access to the working front-end code.</p>\n<h3 id="pure-html-no-javascript">Pure HTML (No Javascript)</h3>\n<p>The first example I want to show you is an HTML form that uses no Javascript.</p>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">enctype</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;multipart/form-data&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">action</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;http://localhost:8080/upload_files&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">method</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST&quot;</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9">&gt;Select file:&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">/&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9"> &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>The form tag must include the <code is:raw>enctype</code> attribute to identify the media, or MIME type. For Multer, you must use <code is:raw>enctype="multipart/form-data"</code>.</p>\n<p>We also include the <code is:raw>action</code> attribute, which tells the form the url of the server and the endpoint. Since my server is running locally on port 8080 and my post endpoint path is <code is:raw>/upload_files</code>, I use the URL <code is:raw>http://localhost:8080/upload_files</code>. Lastly, we tell the form that the fetch method is <code is:raw>POST</code>.</p>\n<p>Don\u2019t forget to include a <code is:raw>name=""</code> with the name field containing the parameter\u2019s name in the Multer upload method used in your Express server. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/QWMQGXa?editors=1010">CodePen</a>.</p>\n<h3 id="html-and-js-using-a-formdata-object">HTML and JS using a FormData object</h3>\n<p>A common need when sending a file is to include extra information with the file that you may want to use for some purpose on your backend, such as data you need to store along with the file. In that case, a way to do this is to use a Javascript FormData object. So in this example, I\u2019ll show you an HTML form that uses Javascript to include the FormData object. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/XWazGem?editors=1011">CodePen</a>.</p>\n<h4 id="html-1">HTML</h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">&gt;Select files&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>\n<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>\n<p>We don\u2019t have to include the enctype attribute in the HTML form since that is already clear by it being a Form Data object we send in the Javascript. Also, the fetch post and URL/endpoint information are also included in the Javascript, so these are not needed in the HTML.</p>\n<h4 id="javascript">Javascript</h4>\n<pre is:raw class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">form</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;form&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">fileInput</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> file</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #8B949E">//input file upload gets the file we want to post:</span></span>\n<span class="line"><span style="color: #D2A8FF">handleAudioFile</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> e.target.files</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> file.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>\n<span class="line"><span style="color: #C9D1D9">    file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> file[i]</span></span>\n<span class="line"><span style="color: #C9D1D9">  }</span></span>\n<span class="line"><span style="color: #C9D1D9">}</span></span>\n<span class="line"><span style="color: #C9D1D9">fileInput.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;change&#39;</span><span style="color: #C9D1D9">, handleAudioFile)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #8B949E">//on clicking the submit button, we create the Form Data object, add the data value of the username to send as part of the request body and add the file to the object</span></span>\n<span class="line"><span style="color: #C9D1D9">form.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;submit&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>\n<span class="line"><span style="color: #C9D1D9">  e.</span><span style="color: #D2A8FF">preventDefault</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">formData</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">FormData</span><span style="color: #C9D1D9">()</span></span>\n<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;username&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;Sandra Rodgers&#39;</span><span style="color: #C9D1D9">)</span></span>\n<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;files&#39;</span><span style="color: #C9D1D9">, file)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;http://localhost:8080/upload_files&#39;</span><span style="color: #C9D1D9">, {</span></span>\n<span class="line"><span style="color: #C9D1D9">    method: </span><span style="color: #A5D6FF">&#39;post&#39;</span><span style="color: #C9D1D9">,</span></span>\n<span class="line"><span style="color: #C9D1D9">    body: formData,</span></span>\n<span class="line"><span style="color: #C9D1D9">  })</span></span>\n<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(res))</span></span>\n<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">catch</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> (</span><span style="color: #A5D6FF">&#39;Error occurred&#39;</span><span style="color: #C9D1D9">, err))</span></span>\n<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>\n<p>The Form Data allows us to send more info as key-value pairs that we can pull from the req.body when it gets to the server. Add the <code is:raw>append("key", "value")</code> to the form data object for any information you want to add. There are <a href="https://javascript.info/formdata">other methods</a> you can use to set up the Form Data object the way you want it.</p>\n<p>When you click the submit button, you can go to the <code is:raw>/uploads</code> folder you set up and see that your file has arrived!</p>\n<h2 id="conclusion">Conclusion</h2>\n<p>Now you are able to use Multer to send files to your Express.js server. Try sending some audio files or even image files. This is a good starting point for taking those files and moving them to another storage place, such as your Cloudinary account or a database.</p>';
}
const $$Astro = createAstro("/Users/sandrarodgers/web-next/blog/src/content/blog/posts/sending-audio-files-to-expressjs-server/index.md", "https://blog.deepgram.com/", "file:///Users/sandrarodgers/web-next/blog/");
const $$Index = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Index;
  new Slugger();
  return renderTemplate`<head>${renderHead($$result)}</head><p>Here at Deepgram, we work with audio files all the time. We have SDKs that make it easy for developers to send audio files to our API. But its also really useful to know how to post an audio file to a backend server in case you ever find yourself needing to do that. So I thought I would introduce a simple way for Node developers to take an audio file that is uploaded through the browser and send it to a backend Express.js server.</p>
<h2 id="express-server">Express Server</h2>
<p>Lets start on the backend with our Express.js server. Express.js is a Node.js framework that provides us with so many useful methods and middleware, making working in Node that much easier.</p>
<p>Well set up the server and implement a middleware package called Multer that helps us handle different file types that we receive to our post endpoint.</p>
<h3 id="get-the-server-running">Get the Server Running</h3>
<p>We can start our project by going into the terminal and making a new node project. Heres a reminder of how you would get that started:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">mkdir project-name</span></span>
<span class="line"><span style="color: #79C0FF">cd</span><span style="color: #C9D1D9"> project-name</span></span>
<span class="line"><span style="color: #C9D1D9">npm init</span></span></code></pre>
<p>If you want to set up a basic Express server, I go over step-by-step how to do that in <a href="https://dev.to/sandrarodgers/basic-express-server-using-replitcom-2ba9">this post</a>. Well use that basic server code to get us started. In your project folder, create a file where you can place this code. The standard is to use <code>app.js</code> as your file where you put your server.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">express</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;express&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">cors</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;cors&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">app</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">express</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">port</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8080</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">use</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">cors</span><span style="color: #C9D1D9">())</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">get</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Hello World&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">(port, () </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">\`Example app listening at http://localhost:\${</span><span style="color: #C9D1D9">port</span><span style="color: #A5D6FF">}\`</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<p>You see that we already have a GET endpoint where it says <code>app.get</code>. However, we dont want to just send out data from our server to the front end, we want to be able to <em>receive</em> an audio file to our server on the backend. So we will set up a POST endpoint to receive a data object sent from the client. Your most basic POST endpoint might look something like this:</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/test&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">json</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;Successful post&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<p>A post endpoint expects a <strong>request body</strong> sent to it from the client-side. (When that data comes through to the server, you can see the data object in your terminal if you <code>console.log</code> the req.body like I did in the example). The format of that data sent in the request body (which is a set of key value pairs) will determine how you deal with the data you have been sent. <strong>A post request using fetch on the client-side might send you a string, a Form Data object, a Blob (for binary data), or URL Search Parameters.</strong></p>
<p>Youre probably more familiar with data being sent as a JSON encoded string, but since we want to send an audio file, we have to prepare for a different kind of data than JSON. On the front end (which well build in the next section), we intend to send the audio file by way of an HTML form, so <strong>we can expect that the data we will be receiving at our server will come in as Form Data</strong> (with a content-type of form/multipart). This <a href="https://javascript.info/fetch#post-requests">tutorial</a> has all the info you need if you want to read more about fetch post requests and the different data types.</p>
<p>Now, we could parse the raw data of the sound file ourselves (which would require a bunch of code and would probably make us feel very accomplished when we finally manage to get it working), or we could take advantage of the beauty of Node and use a tool that has already been made to help us with this immense task. There are <a href="https://npm.io/search/keyword:form-data">plenty of packages</a> to choose from to help us handle Form Data, but since we are using Express, a great choice is <a href="http://expressjs.com/en/resources/middleware/multer.html">Multer</a>.</p>
<h3 id="multer">Multer</h3>
<p>Multer is a node.js middleware for handling multipart/form-data. If youre familiar with <a href="https://www.npmjs.com/package/body-parser">body-parser</a>, Multer is similar, except it is built only to deal with multipart bodies.</p>
<p>To use middleware in Express, we must bring in the package using <code>require</code>. We will also want to configure Multer for our needs, and we want to make sure that the audio file we are receiving actually gets written to the disk rather than just stored in memory. So we will include an options object like so <code>const upload = multer({opts})</code>, with opts being the specific options for our configuration. <strong>If you do not use the options object, multer will write the file to memory, so make sure you use the options object if you want your file stored on your disk.</strong></p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>
<p>Right now, that storage property doesnt have anything behind it. Its an empty variable. But Im going to show you how I configure that storage option.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">multer</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">require</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;multer&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">storage</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> multer.</span><span style="color: #D2A8FF">diskStorage</span><span style="color: #C9D1D9">({</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">filename</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;filename&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, file.originalname)</span></span>
<span class="line"><span style="color: #C9D1D9">  },</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">destination</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">file</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">cb</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;storage&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">cb</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;./uploads&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  },</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">upload</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">multer</span><span style="color: #C9D1D9">({ storage })</span></span></code></pre>
<p>As you can see, I want to configure <em>how</em> we store the file. Using this <code>storage</code> option lets us use the Multer <a href="https://github.com/expressjs/multer#storage">disk storage engine</a>, which basically lets us program <strong>how we want the file to be named</strong> (using the disk storage <code>filename</code> method) and <strong>where we wanted it to be stored</strong> (using the disk storage <code>destination</code> method) . You can see in my code that Im choosing to name the file exactly what it was named originally when it was sent to us from the client-side, and I am choosing to store it in a folder called <code>/uploads</code>.</p>
<p>Now I will write out my post endpoint. It will include the Multer upload middleware. Since we are only uploading one file, I am using <code>upload.single()</code> but if you want to upload multiple files, Multer also has the <code>upload.array()</code> method. Multer adds a <strong>request file</strong> object which contains the file, and a <strong>request body</strong> object which contains the values of the text fields of the form.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">app.</span><span style="color: #D2A8FF">post</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;/upload_files&#39;</span><span style="color: #C9D1D9">, upload.</span><span style="color: #D2A8FF">single</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">), (</span><span style="color: #FFA657">req</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.body)</span></span>
<span class="line"><span style="color: #C9D1D9">  console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(req.file)</span></span>
<span class="line"><span style="color: #C9D1D9">  res.</span><span style="color: #D2A8FF">send</span><span style="color: #C9D1D9">({ message: </span><span style="color: #A5D6FF">&#39;Successfully uploaded files&#39;</span><span style="color: #C9D1D9"> })</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<p>One crucial thing to be sure of is that the parameter you include in the method (in this case, file in <code>upload.single("file")</code> must correspond to the name field in your HTML form file input. According to the <a href="https://github.com/expressjs/multer#usage">Multer</a> docs:</p>
<blockquote>
<p>It is important that you use the <code>name</code> field value from the form in your upload function. This tells multer which field on the request it should look for the files in. If these fields arent the same in the HTML form and on your server, your upload will fail.</p>
</blockquote>
<p>We will make sure those values correspond when we build our HTML form in the next section.</p>
<h2 id="html">HTML</h2>
<p>Over to the front-end now. In your project, you can make an <code>index.html</code> file, or you can test this out in something like CodePen. Ill link to both my examples in CodePen so you have access to the working front-end code.</p>
<h3 id="pure-html-no-javascript">Pure HTML (No Javascript)</h3>
<p>The first example I want to show you is an HTML form that uses no Javascript.</p>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">enctype</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;multipart/form-data&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">action</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;http://localhost:8080/upload_files&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">method</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST&quot;</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9">&gt;Select file:&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">    &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file-upload&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">/&gt;</span></span>
<span class="line"><span style="color: #C9D1D9"> &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>The form tag must include the <code>enctype</code> attribute to identify the media, or MIME type. For Multer, you must use <code>enctype="multipart/form-data"</code>.</p>
<p>We also include the <code>action</code> attribute, which tells the form the url of the server and the endpoint. Since my server is running locally on port 8080 and my post endpoint path is <code>/upload_files</code>, I use the URL <code>http://localhost:8080/upload_files</code>. Lastly, we tell the form that the fetch method is <code>POST</code>.</p>
<p>Dont forget to include a <code>name=""</code> with the name field containing the parameters name in the Multer upload method used in your Express server. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/QWMQGXa?editors=1010">CodePen</a>.</p>
<h3 id="html-and-js-using-a-formdata-object">HTML and JS using a FormData object</h3>
<p>A common need when sending a file is to include extra information with the file that you may want to use for some purpose on your backend, such as data you need to store along with the file. In that case, a way to do this is to use a Javascript FormData object. So in this example, Ill show you an HTML form that uses Javascript to include the FormData object. See my working code at this <a href="https://codepen.io/sandrarodgers/pen/XWazGem?editors=1011">CodePen</a>.</p>
<h4 id="html-1">HTML</h4>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&lt;</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">for</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9">&gt;Select files&lt;/</span><span style="color: #7EE787">label</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">id</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">name</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;file&quot;</span><span style="color: #C9D1D9"> /&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">  &lt;</span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">type</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;submit&quot;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">value</span><span style="color: #C9D1D9">=</span><span style="color: #A5D6FF">&quot;POST to server&quot;</span><span style="color: #C9D1D9">&gt;&lt;/</span><span style="color: #FFA198">input</span><span style="color: #C9D1D9">&gt;</span></span>
<span class="line"><span style="color: #C9D1D9">&lt;/</span><span style="color: #7EE787">form</span><span style="color: #C9D1D9">&gt;</span></span></code></pre>
<p>We dont have to include the enctype attribute in the HTML form since that is already clear by it being a Form Data object we send in the Javascript. Also, the fetch post and URL/endpoint information are also included in the Javascript, so these are not needed in the HTML.</p>
<h4 id="javascript">Javascript</h4>
<pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">form</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">querySelector</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;form&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">fileInput</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> document.</span><span style="color: #D2A8FF">getElementById</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;file&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> file</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">//input file upload gets the file we want to post:</span></span>
<span class="line"><span style="color: #D2A8FF">handleAudioFile</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> e.target.files</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> file.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    file </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> file[i]</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"><span style="color: #C9D1D9">fileInput.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;change&#39;</span><span style="color: #C9D1D9">, handleAudioFile)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">//on clicking the submit button, we create the Form Data object, add the data value of the username to send as part of the request body and add the file to the object</span></span>
<span class="line"><span style="color: #C9D1D9">form.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;submit&#39;</span><span style="color: #C9D1D9">, (</span><span style="color: #FFA657">e</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  e.</span><span style="color: #D2A8FF">preventDefault</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">formData</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">FormData</span><span style="color: #C9D1D9">()</span></span>
<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;username&#39;</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;Sandra Rodgers&#39;</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  formData.</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;files&#39;</span><span style="color: #C9D1D9">, file)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">fetch</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;http://localhost:8080/upload_files&#39;</span><span style="color: #C9D1D9">, {</span></span>
<span class="line"><span style="color: #C9D1D9">    method: </span><span style="color: #A5D6FF">&#39;post&#39;</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    body: formData,</span></span>
<span class="line"><span style="color: #C9D1D9">  })</span></span>
<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">res</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(res))</span></span>
<span class="line"><span style="color: #C9D1D9">    .</span><span style="color: #D2A8FF">catch</span><span style="color: #C9D1D9">((</span><span style="color: #FFA657">err</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=&gt;</span><span style="color: #C9D1D9"> (</span><span style="color: #A5D6FF">&#39;Error occurred&#39;</span><span style="color: #C9D1D9">, err))</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<p>The Form Data allows us to send more info as key-value pairs that we can pull from the req.body when it gets to the server. Add the <code>append("key", "value")</code> to the form data object for any information you want to add. There are <a href="https://javascript.info/formdata">other methods</a> you can use to set up the Form Data object the way you want it.</p>
<p>When you click the submit button, you can go to the <code>/uploads</code> folder you set up and see that your file has arrived!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Now you are able to use Multer to send files to your Express.js server. Try sending some audio files or even image files. This is a good starting point for taking those files and moving them to another storage place, such as your Cloudinary account or a database.</p>`;
}, "/Users/sandrarodgers/web-next/blog/src/content/blog/posts/sending-audio-files-to-expressjs-server/index.md");

export { compiledContent, $$Index as default, frontmatter, metadata, rawContent };
